<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>A1C → eAG Converter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap 5 + Icons + jQuery -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root{
      --brand-ink:#0f172a;
      --brand-muted:#475569;
      --brand-accent:#0ea5e9;
      --brand-soft:#e0f2fe;
      --row:#f8fafc;
      --ring: rgba(14,165,233,.25);
    }
    body{
      color: var(--brand-ink);
      background: linear-gradient(180deg,#ffffff, #f9fbff 30%, #f6fbff);
    }
    .navbar{
      background: #ffffffcc;
      backdrop-filter: blur(6px);
      border-bottom: 1px solid #e9eef5;
    }
    .page-title{ letter-spacing:.2px; }
    .subtle{ color: var(--brand-muted); }
    .card{
      border-radius: 16px;
      border: 1px solid #e7eef6;
      box-shadow: 0 6px 18px rgba(15,23,42,.06);
    }
    .accent-chip{
      background: var(--brand-soft);
      color: #075985;
      border: 1px solid #bae6fd;
    }
    .form-control:focus{
      border-color: var(--brand-accent);
      box-shadow: 0 0 0 .2rem var(--ring);
    }
    .result-badge{ font-size: 1.15rem; }
    .table thead th{
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 1;
      border-bottom: 2px solid #e8edf4 !important;
    }
    .highlight-row{
      animation: glow 600ms ease-in-out;
      outline: 2px solid #fde68a;
    }
    @keyframes glow {
      from { box-shadow: 0 0 0 rgba(253,230,138,0); }
      to   { box-shadow: 0 0 0 rgba(253,230,138,.0); }
    }
    .scrollbox{
      max-height: 440px;
      overflow: auto;
      border: 1px solid #e8edf4;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <!-- Nav -->
  <nav class="navbar navbar-light sticky-top">
    <div class="container">
      <span class="navbar-brand d-flex align-items-center gap-2">
        <i class="bi bi-activity text-primary"></i>
        <strong>A1C → eAG</strong>
      </span>
      <span class="badge rounded-pill accent-chip d-none d-md-inline">Clinically-used formula</span>
    </div>
  </nav>

  <main class="container my-5">
    <div class="row g-4 align-items-stretch">
      <div class="col-12">
        <h1 class="page-title h3 mb-1">A1C → eAG Converter</h1>
        <p class="subtle mb-4">Translate your A1C to an estimated average glucose in mg/dL and mmol/L using the standard formula:
          <span class="fst-italic">eAG (mg/dL) = 28.7 × A1C − 46.7</span>.
        </p>
      </div>

      <!-- Converter card -->
      <div class="col-12 col-lg-6">
        <div class="card h-100">
          <div class="card-body p-4">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h2 class="h5 mb-0">Quick Convert</h2>
              <span class="badge rounded-pill text-bg-light">
                <i class="bi bi-info-circle me-1"></i>
                Normal &lt; 5.7% · Prediabetes 5.7–6.4% · Diabetes ≥ 6.5%
              </span>
            </div>

            <div class="row g-3 align-items-end">
              <div class="col-12">
                <label for="a1cInput" class="form-label fw-semibold">A1C (%)</label>
                <div class="input-group input-group-lg">
                  <span class="input-group-text"><i class="bi bi-percent"></i></span>
                  <input id="a1cInput" type="number" step="0.1" min="3" max="15"
                         class="form-control" placeholder="e.g., 5.6" inputmode="decimal" />
                </div>
              </div>

              <div class="col-12">
                <div class="p-3 bg-light border rounded-3 d-flex flex-wrap align-items-center gap-3">
                  <div class="me-auto">
                    <div class="small text-uppercase text-muted">Estimated Average Glucose</div>
                    <div id="liveResultText" class="fw-semibold">Enter an A1C to calculate eAG…</div>
                  </div>
                  <div class="d-flex gap-2">
                    <span id="badgeMg" class="badge text-bg-primary result-badge">— mg/dL</span>
                    <span id="badgeMmol" class="badge text-bg-secondary result-badge">— mmol/L</span>
                    <button id="copyBtn" class="btn btn-outline-primary btn-sm">
                      <i class="bi bi-clipboard-check me-1"></i>Copy
                    </button>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="alert alert-info mb-0">
                  Walking <strong>10–15 minutes after meals</strong> can help reduce post-meal glucose spikes.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Table card -->
      <div class="col-12 col-lg-6">
        <div class="card h-100">
          <div class="card-body p-4">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h2 class="h5 mb-0">Reference Table</h2>
              <div class="d-flex align-items-center gap-2">
                <span class="small text-muted">4.0% → 10.0% (0.1% steps)</span>
                <span class="badge rounded-pill accent-chip"><i class="bi bi-magic me-1"></i>Auto-highlights your input</span>
              </div>
            </div>

            <div class="scrollbox">
              <table class="table table-hover align-middle mb-0">
                <thead>
                  <tr>
                    <th scope="col">A1C (%)</th>
                    <th scope="col">eAG (mg/dL)</th>
                    <th scope="col">eAG (mmol/L)</th>
                  </tr>
                </thead>
                <tbody id="refBody"></tbody>
              </table>
            </div>

            <p class="text-muted small mt-3 mb-0">
              eAG mg/dL rounded to nearest whole number; mmol/L to one decimal.
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="container pb-5">
    <div class="text-center text-muted small">
      For education only; not medical advice. Always confirm with your clinician.
    </div>
  </footer>

  <script>
    // --- Core conversion ---
    function a1cToEag(a1c) {
      const mg = (28.7 * a1c) - 46.7;
      const mmol = mg / 18;
      return {
        mgRounded: Math.round(mg),
        mmolRounded: mmol.toFixed(1)
      };
    }

    // Build reference rows 4.0 → 10.0 in 0.1 steps
    function buildReference() {
      const $body = $("#refBody");
      const rows = [];
      for (let a = 4.0; a <= 10.0001; a += 0.1) {
        const a1c = +(a.toFixed(1));
        const e = a1cToEag(a1c);
        rows.push(
          `<tr data-a1c="${a1c}">
             <td class="fw-semibold">${a1c.toFixed(1)}</td>
             <td>${e.mgRounded}</td>
             <td>${e.mmolRounded}</td>
           </tr>`
        );
      }
      $body.html(rows.join(""));
    }

    // Ensure a row is visible within the scrollbox
    function ensureRowVisible($row){
      const $box = $(".scrollbox");
      if ($box.length === 0 || $row.length === 0) return;

      const boxEl = $box.get(0);
      const headerH = $box.find("thead").outerHeight() || 0;

      const boxRect = boxEl.getBoundingClientRect();
      const rowRect = $row.get(0).getBoundingClientRect();

      const current = $box.scrollTop();
      const rowTopRel = (rowRect.top - boxRect.top) + current;
      const rowHeight = $row.outerHeight();
      const boxHeight = $box.innerHeight();

      const visibleHeight = boxHeight - headerH;
      let target = rowTopRel - headerH - (visibleHeight - rowHeight)/2;
      if (target < 0) target = 0;

      $box.stop(true).animate({scrollTop: target}, 320);
    }

    // Highlight & auto-scroll to closest row
    function highlightClosestRow(a1c) {
      const $rows = $("#refBody tr");
      $rows.removeClass("table-warning highlight-row");
      if (isNaN(a1c)) return;

      let $closest = $();
      let bestDiff = Infinity;
      $rows.each(function(){
        const val = parseFloat(this.dataset.a1c);
        const diff = Math.abs(val - a1c);
        if (diff < bestDiff) { bestDiff = diff; $closest = $(this); }
      });

      if ($closest.length) {
        $closest.addClass("table-warning highlight-row");
        ensureRowVisible($closest);
      }
    }

    // Update live UI
    function updateLive(a1cVal) {
      const a1c = parseFloat(a1cVal);
      const $text = $("#liveResultText");
      const $mg = $("#badgeMg");
      const $mmol = $("#badgeMmol");

      if (isNaN(a1c)) {
        $text.text("Enter an A1C to calculate eAG…");
        $mg.text("— mg/dL");
        $mmol.text("— mmol/L");
        highlightClosestRow(NaN);
        return;
      }

      const e = a1cToEag(a1c);
      $text.html(`A1C <span class="text-muted">${a1c.toFixed(1)}%</span> ≈ <strong>${e.mgRounded} mg/dL</strong> (<span class="text-muted">${e.mmolRounded} mmol/L</span>)`);
      $mg.text(`${e.mgRounded} mg/dL`);
      $mmol.text(`${e.mmolRounded} mmol/L`);
      highlightClosestRow(a1c);
    }

    // Copy to clipboard
    function copyValues() {
      const mg = $("#badgeMg").text();
      const mmol = $("#badgeMmol").text();
      const txt = `eAG: ${mg} (${mmol})`;
      navigator.clipboard.writeText(txt).then(() => {
        const btn = $("#copyBtn");
        const original = btn.html();
        btn.html('<i class="bi bi-check2-circle me-1"></i>Copied');
        btn.addClass('btn-success').removeClass('btn-outline-primary');
        setTimeout(()=> {
          btn.html(original);
          btn.addClass('btn-outline-primary').removeClass('btn-success');
        }, 1200);
      });
    }

    // Init
    $(function(){
      buildReference();
      $("#a1cInput").on("input", function(){ updateLive(this.value); });
      $("#copyBtn").on("click", copyValues);
    });
  </script>
</body>
</html>
